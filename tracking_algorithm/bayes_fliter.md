# **Bayes Fliter**

- 贝叶斯滤波基于贝叶斯公式，通过上一时刻的状态及当前时刻的输入，对当前时刻的状态作出预测，并通过当前时刻的观测对预测作出更新（也可称为纠正），最终实现对当前时刻状态的估计。贝叶斯滤波思想是卡尔曼滤波、粒子滤波等算法的基础。本文从概率基础概念出发，逐步进行贝叶斯滤波的推导。

## 概率基础知识

### 随机变量
定义在样本空间 $\Omega$ 上的实值函数： 

$$
X = X(\omega), \omega \in \Omega
$$ 

被称作为**随机变量**,如下图所示： $\omega$ 表示样本空间 $\Omega$ 的**随机事件**，可能与数据量有关（如激光雷达测量得到的前方障碍物的距离值，随机投掷骰子得到的点数），也可能和数量无关（如随机投掷硬币的结果可能为正面或者反面）。

![image](https://github.com/CaiRugou/Autonomous/blob/main/img/sample.png)

**随机变量**表示**随机试验各种*结果*的实值单值函数**。随机事件不论与数量是否直接有关，都可以数量化，即都能用数量化的方式表达。

“随机变量 $X$ 的取值为 $x$ ”就是满足等式 $X(\omega) = x$ 的一切 $\omega$ 组成的集合，简记为“ $X=x$ ”, 这是 $\Omega$ 的一个子集，即：

$$
X=x = {\omega : X(\omega) = x} \subset \Omega
$$

类似地，有：

$$
X \leq x = {\omega : X(\omega) \leq x} \subset \Omega
$$

### 离散型随机变量
如果随机变量的函数值是实数轴上孤立的点（有限个或者无限个），则称为**离散型随机变量**：

![image](https://github.com/CaiRugou/Autonomous/blob/main/img/aix.png)

### 连续型随机变量
如果随机变量的函数值是实数轴上某个区间上所有的值（也可以是 $(−∞,+∞)$ 区间），则称为连续型随机变量：

![image](https://github.com/CaiRugou/Autonomous/blob/main/img/continue.png)

### 累积分布函数
设 $X$ 为一个随机变量，对于任意实数 $x$ ,称：

 $$
 F(x) = P(X \leq x)
 $$

为随机变量 $X$ 的累积分布函数(Cumulative Distribution Function，CDF), 又称作概率分布函数，简称**分布函数**。

若 $X$ 为离散型随机变量，存在函数 $f_X(x)$ ,使其分布函数满足：

$$
F(x) = P(X \leq x) = \sum_{u \leq x} f_X(u)
$$

若 $X$ 为连续型随机变量，存在函数 $f_X(x)$ ,使其分布函数满足：

$$
F(x) = P(X \leq x) = \int_ {-\infty}^xf_X(u)du
$$

分布函数满足单调性、有界性和右连续性：
- 单调性

  对任意 $x_1 \leq x_2$ ,有 $F(x_1) \leq F(x_2)$

- 有界性

  对任意 $x$ ,有：

$$
    0 \leq F(x) \leq 1
$$

  且有：

$$
    \lim_{x->-\infty} = 0, \lim_{x->+\infty} = 1
$$

- 右连续性
  对任意 $x_0$ ,有：

$$
  \lim_{x->x_0^+} F(x) = F(x_0)
$$

### 概率质量函数

假设 $X$ 为离散型随机变量，其全部可能取值为 $x_1,x_2,x_3,⋅⋅⋅$ ，其概率分布列可表述为：

| $X$ | $x_1$    | $x_2$    | $x_3$    | $...$ |
|-    | :-:      | :-:      | :-:      | -:    |
| $P$ | $p(x_1)$ | $p(x_2)$ | $p(x_3)$ | $...$ | 

则称：

$$
  f_X(x) = \begin {cases}  p(x)=P(X=x), x\in{x_i}, i=1,2,3,... \\ 0, other \end {cases} 
$$

为离散型随机变量 $X$ 的概率质量函数Probability Mass Function，PMF）。也可以采用如下的表示方法：

$$
X :~ p(x)
$$

表示 $X$ 服从 $p(x)$ 的概率分布。
概率质量函数表征了离散型随机变量在各特定取值上的概率，其满足非负性、规范性和可加性：
- 非负性

$$
f_X(x_i) \geq 0
$$

- 规范性和可加性

$$
\sum_{i=1}^\infty f_X(x_i) = 1
$$

**离散型随机变量概率质量函数**的**叠加**得到了离散型随机变量的**累积分布函数**。

### 概率密度函数

假设 $X$ 为连续型随机变量，存在函数 $f_X(x)$，且满足：

- 非负性

$$
f_X(x_i) \geq 0
$$

- 规范性和可加性

$$
\int_{-\infty}^{+\infty} f_X(x)dx = 1
$$

则称函数 $f_X(x)$ 为连续型随机变量 $X$

的概率密度函数（Probability Density Function，PDF），连续型随机变量概率密度函数的积分得到了连续型随机变量的累积分布函数。

概率密度函数表征了连续型随机变量的输出值在某个确定的取值点附近的可能性。连续型随机变量的输出值在某个确定的取值点上的概率为 $0$ ，但并不代表该事件不会发生。

### 联合概率

#### 二维离散型随机变量的联合概率质量函数

若二维离散型随机变量 $(X,Y)$ 所有可能的取值为:

$$
(x_i, y_j), i,j = 1,2,3,...
$$

且存在函数 $f_{X,Y}(x,y)$ :


$$
f_{X,Y}(x,y) = p(x,y) = P(X=x, Y=y), (x,y)\in{x_i,y_i},i,j=1,2,3,...
$$

函数 $f_{X,Y}(x,y)$ 满足如下性质：

- 非负性

$$
f_{X,Y}(x_i,y_j) \geq 0
$$

- 规范性和可加性

$$
\sum_{i=1}^\infty \sum_{j=1}^\infty f_{X,Y}(x_i, y_j) = 1
$$

则称函数 $f_{X,Y}(x,y)$ 为 $(X,Y)$ 的联合概率质量函数（Joint Probability Mass Function），又称联合分布列，此定义可以推广到多维离散型随机变量。

**二维离散型随机变量联合概率质量函数**的**叠加**得到了二维离散型随机变量的联合累积分布函数（Joint Cumulative Distribution Function）:

$$
F_{X,Y}(x,y) = P(X \leq x, Y \leq y) = \sum_{u \leq x} \sum_{v \leq y}f_{X,Y}(u,v)
$$

#### 二维连续型随机变量的联合概率密度函数

若对于二维连续型随机变量 $(X,Y)$ ，存在二元函数 $f_{X,Y}(x,y)$ 满足：

- 非负性

$$
    f_{X,Y}(x,y) \geq 0
$$

- 规范性和可加性

$$
\int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f_{X,Y}(x,y)dxdy = 1
$$

则称函数 $f_{X,Y}(x,y)$ 为 $(X,Y)$ 的联合概率密度函数（Joint Probability Density Function），此定义可以推广到多维连续型随机变量。

二维连续型随机变量联合概率密度函数的积分得到了二维连续型随机变量的联合累积分布函数：

$$
F_{X,Y}(x,y)=P(X \leq x,Y \leq y)= \int_{-\infty}^x \int_{-\infty}^y f_{X,Y}(u,v)dvdu
$$

### 边缘概率
#### 二维离散型随机变量的边缘概率质量函数
若二维离散型随机变量 $(X,Y)$ 所有可能得取值为

$$
(x_i,y_j), i,j=1,2,3,...
$$

且联合概率质量函数 $f_{X,Y}(x,y)$ 为：

$$
f_{X,Y}(x,y) = p(x,y)=P(X=x,Y=y),(x,y)\in {x,y},i,j=1,2,3,...
$$

对 $j$ 求和所得的函数：

$$
f_X(x)=\sum_{j=1}^\infty f_{X,Y}(x,y_i) = \sum_{j=1}^\infty P(X=x,Y=y_j) = P(X=x), x\in \{x_i\}, i=1,2,3,...
$$

称为 $X$ 的**边缘概率质量函数**（Marginal Probability Mass Function），又称边缘分布列。

类似的对 $i$ 求和所得的函数：

$$
f_Y(y) = \sum_{i=1}^\infty f_{X,Y}(x_i, y) = \sum_{i=1}^\infty P(X=x, Y=y) = P(Y=y), y \in \{y_i\}, j = 1,2,3,...
$$

称为 $Y$ 的边缘概率质量函数。

**二维离散型随机变量边缘概率质量函数的叠加得到了二维离散型随机变量的边缘累积分布函数（Marginal Cumulative Distribution Function）：**

$$
F_X(x) = P(X \leq x) = \sum_{u \leq x} f_X(u) = \sum_{u \leq x} \sum_{j=1}^\infty P(X=u, Y=y_i) = \sum_{u \leq x} P(X=x)
$$

$$
F_Y(y) = P(Y \leq y) = \sum_{v \leq y}f_Y(v) = \sum_{v \leq y} \sum_{x=1}^\infty P(X=u_i, Y=y) = \sum_{v \leq y} P(Y=y)
$$

##### **离散联合概率举例**

上文提到**随机变量**，一个随机变量是从样本空间到实数的映射。然而，所谓的映射是人为创造的。从一个样本空间，可以同时产生多个映射。比如，我们的实验是**连续三次投硬币**，样本空间为 $\Omega$ :

$$
\Omega = \begin {cases} 正正正， 正正反，正反正，反正正，正反反，反正反，反反正，反反反 \end {cases}
$$

在**同一样本空间**上，我们可以定义**多个随机变量**，映射到实数空间 $R$，比如:

- $X$ : 每次投掷为正面的硬币的总数，可以取值 $0，1，2，3 $
- $Y$ : 最后一次出现反面的情况，可以取值 $0, 1$ 
- $Z$ : 将正记着10，反面记着5， 第一次和第三次取值差值，可以取值为 $5, -5, 0$

这三个随机变量 $X, Y, Z$ 可以看作有三个分量的矢量，所以定义在同一个样本空间的多个随机变量，是一个样本空间到矢量的映射。其中投掷硬币就是**随机事件**。

如果样本空间 $\Omega$ 中每个结果出现的概率相等。可以知道该样本空间有 $8$ 个结果，那么每个结果出现的概率为 $1 \over 8$ 。由此我们可以计算联合概率，比如：

$$
P(X=0,Y=1) = P({反反反}) = {1 \over 8}
$$

表示 $X$ 中出现正面次数为 $0$ 且 $Y$ 中出现最后一次出现反面

$$
P(X=1, Y=1) = P({正反反，反正反}) = {2 \over 8}
$$

对于 $X=x,Y=y，$ 我们寻找样本空间中满足这两个取值的所有元素。这些元素构成一个样本空间的子集，该子集的概率就是 $P(X=x,Y=y)$ 的联合概率。 $p(x,y)=P(X=x,Y=y)$ 称为联合概率质量函数(joint PMF, joint probability mass function)。联合概率可以看做两个事件同时发生时的概率，事件 $A$ 为 $X=x$ ，事件 $B$ 为 $Y=y$ ，即 $P(A\bigcap B)$ 。

找到所有可能取值组合的概率，就找到了这两个随机变量的联合分布:

| $X$ | $Y$ | $P(X,Y)$ | 对应子集   |
|-    | :-:         | :-:      | :-:       |
| 0 | 0 | 0         | $\emptyset$          |
| 1 | 0 | $1\over8$ | ${反反正}$          |
| 2 | 0 | $2\over8$ | ${反正正}，{正反正}$ |
| 3 | 0 | $1\over8$ | ${正正正}$ |
| 0 | 1 | $1\over8$ | ${反反正}$ |
| 1 | 1 | $1\over8$ | ${正反反}，{反正反}$ |
| 2 | 1 | $2\over8$ | ${正正反}$ |
| 3 | 1 | $0$       | $\emptyset$ |

联合分布描述了所有可能得取值情况。因此，联合概率密度函数的累计和为 $1$ 。